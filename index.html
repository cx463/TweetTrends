<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">			        <!-- for IE8 style -->
        <meta name="twitmap" content="width=device-width, initial-scale=1">	    <!-- for suiting different window sizes -->

        <title>Twitter Map</title>
        <link rel="icon" href="./static/images/logo.png">

        <link href="./static/css/bootstrap.min.css" rel="stylesheet">		     <!-- for normal page element size -->
        <link href="./static/css/bootstrap-theme.min.css" rel="stylesheet">      <!-- ?? -->
        <link href="./static/css/font-awesome.min.css" rel="stylesheet">		 <!-- for pictures linking to external websites -->
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,700,700i" rel="stylesheet">		        <!-- ?? -->
        <link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,700,700i|Josefin+Sans:700" rel="stylesheet">	<!-- font for title -->
        <link href="./static/css/main.css" rel="stylesheet">			         <!-- for basic page elements style -->			
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">		        <!-- for flash of page turner -->
    </head>

    <body>
        <div id="index">							        <!-- Main Page starts here -->
            <div class="container main">					<!-- basic size of page -->
                <div class="row home">						<!-- home for only main page -->
                    <div id = "index_right" class="col-md-12 text-center right">
                        <div class="logo">
                            <img src="./static/images/logo.png">
                            <h2>Twitter Map</h2>
                        </div>
                        <p class="home-description">
                            Hi, this is a website that could check any latest Twitter where you expect !!
                        </p>
                        <div class="btn-group-vertical custom_btn animated slideinright">
                            <div id="how" class="btn btn-rabbit"> How to check? </div>
                            <div id="about" class="btn btn-rabbit"> About us </div>
                            <div id="contact" class="btn btn-rabbit"> Contact us </div>
                        </div>      
                        <div class="social">
                            <a href="http://engineering.nyu.edu/" target="_blank"><i class="fa fa-university" aria-hidden="true"></i></a>
                            <a href="https://www.facebook.com/nyutandon/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                            <a href="https://twitter.com/nyutandon" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                        </div>
                    </div>
                </div>
                <div class="row home">
                    <div id = "index_left" class="col-md-12">
                        <div class="text-center left">
		                    <div class="dropdown">
		                        <br> <button onclick="myFunction()" class="dropbtn"> Filter </button>
  		                        <div id="myDropdown" class="dropdown-content">
    		                        <form id = "ddform" method="get">
				                        <br>
                        	            <form class="form_edit"> 

                        	                <p class="menu-words">Coordinates:</p>
                                            <div class="menu-form" align="middle">
                                                <input type="text" class="form-control" id="markerCoord" placeholder="Coor">
                                            </div>

                        	                <p class="menu-words">Users:</p>
                                            <div class="menu-form" align="middle">
                            	                <input type="text" class="form-control" id="User" placeholder="">
                                            </div>

                        	                <p class="menu-words">Keywords:</p>
                                            <div class="menu-form" align="middle">
                            	                <input type="text" class="form-control" id="KeyWord" placeholder="">
                                            </div>

                        	                <p class="menu-words">Hashtags:</p>
                                            <div class="menu-form" align="middle">
                            	                <input type="text" class="form-control" id="Tag" placeholder="">
                                            </div>
                                        </form>
	 			                        <button id="button" align="middle" class="btn btn-rabbit"> Submit </button> <br> <br>
			                        </form>
  			                    </div>
		                    </div>
                        </div>
                        <div id="map"></div>
		            </div>
                </div>
            </div>

            <div class="loadingAni"></div>

            <footer class="text-center">
                <div class="container bottom">
                    <div class="row">
                        <div class="col-sm-12">
                            <p>Made by Guangkun Li (gl1546) & Chenyu Xu (cx463)</p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>								<!-- Main Page ends here -->

        <div id="how_scroll" class="pages">				<!-- How to Check starts here  -->
            <div class="container main">
                <div class="row">
                    <div id = "how_right" class="col-md-12 text-center right">
                        <div class="logo">
                            <img src="./static/images/logo.png">
                            <h2>Twitter Map</h2>
                        </div>
                        <p class="home-description">
                            Hi, this is a website that could check any latest Twitter where you expect !!
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div id = "how_left" class="col-md-12 text-center left">
                        <a href="#index" class="btn btn-rabbit back"> <i class="fa fa-angle-left" aria-hidden="true"></i> Back to home</a>
                        <div id="watermark">
                            <h2 class="page-title" text-center> How to Check? </h2>
                            <div class="marker"> HOW </div>
                        </div>
			            <br>
                        <p class='menu-words mainbody' style="text-align: left">1. Drag or single click the marker to change the coordinates;</p>
			            <p class='menu-words mainbody' style="text-align: left">2. Please click on the "Filter" button and offer search criteria in the dropdown;</p>
                        <p class='menu-words mainbody' style="text-align: left">3. Please click on the "Submit" button to start searching nearby tweets of the marker location;</p>
			            <p class='menu-words mainbody' style="text-align: left">4. Be aware of the Filter, it may not return any result if no tweets meet your search criteria.</p>
                        <br> <br> <br> <br>
                    </div>
		        </div>
            </div>            

            <footer class="text-center">
                <div class="container bottom">
                    <div class="row">
                        <div class="col-sm-12">
                            <p>Made by Guangkun Li (gl1546) & Chenyu Xu (cx463)</p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>								                <!-- How to Check ends here -->

        <div id="about_scroll" class="pages">				<!-- About Us starts here -->
            <div class="container main">
                <div class="row">
                    <div id = "about_right" class="col-md-12 text-center right">
                        <div class="logo">
                            <img src="./static/images/logo.png">
                            <h2>Twitter Map</h2>
                        </div>
                        <p class="home-description">
                            Hi, this is a website that could check any latest Twitter where you expect !!
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div id = "about_left" class="col-md-12 text-center left">
                        <a href="#index" class="btn btn-rabbit back"> <i class="fa fa-angle-left" aria-hidden="true"></i> Back to home </a>
                        <div id="watermark">
                            <h2 class="page-title" text-center> About Us </h2>
                            <div class="marker"> About </div>
                        </div>
			            <br>
                        <p class='menu-words mainbody' style="text-align: left">We are ...</p>
                    </div>
		        </div>
            </div> 

            <footer class="text-center">
                <div class="container bottom">
                    <div class="row">
                        <div class="col-sm-12">
                            <p>Made by Guangkun Li (gl1546) & Chenyu Xu (cx463)</p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>								                <!-- About Us ends here  -->

        <div id="contact_scroll" class="pages">				<!-- Contact starts here -->
            <div class="container main">
                <div class="row">
                    <div id = "contact_right" class="col-md-12 text-center right">
                        <div class="logo">
                            <img src="./static/images/logo.png">
                            <h2>Twitter Map</h2>
                        </div>
                        <p class="home-description">
                            Hi, this is a website that could check any newest Twitter where you expect !!
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div id = "contact_left" class="col-md-12 text-center left">
                        <a href="#index" class="btn btn-rabbit back"> <i class="fa fa-angle-left" aria-hidden="true"></i> Back to Home </a>
                        <div id="watermark">
                            <h2 class="page-title" text-center> Contact Us</h2>
                            <div class="marker"> Contact </div>
                        </div>
                        <p class='menu-words mainbody' style="text-align: left"> We are located in NYU Tandon School of Engineering 6 MetroTech Center, Brooklyn, NY 11201 </p>
                        <p class='menu-words mainbody' style="text-align: left"> Please contact us through email: gl1546@nyu.edu & cx463@nyu.edu </p>

                        <form id = "submitform" class="form_edit"> 
                            <div class="form-group mainbody">
                                <input type="name" class="form-control" id="InputName" placeholder="Name">
                            </div>

                            <div class="form-group mainbody">
                                <input type="email" class="form-control" id="InputEmail" placeholder="Email">
                            </div>

                            <div class="form-group mainbody">
                                <textarea class="form-control" rows="5" placeholder="InputMessage"></textarea>
                            </div>
                            <button type="submit" class="btn btn-rabbit submit" onclick="myFunction2()"> Send Message</button>
                        </form>
                    </div>
                </div>
            </div>
       
            <footer class="text-center">
                <div class="container bottom">
                    <div class="row">
                        <div class="col-sm-12">
                            <p>Made by Guangkun Li (gl1546) & Chenyu Xu (cx463)</p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>								<!-- Contact ends here -->
        
        <script src="./static/js/jquery-3.1.0.min.js"></script>
        <script src="./static/js/bootstrap.min.js"></script>
        <script src="./static/js/script.js"></script>
    </body>
</html>

<style>
.dropbtn {
	padding: 12px 87.5px;
	font-size: 16px;
	cursor: pointer;
	background-color: #fff;
	color: #111;
	font-style: italic;
	border: 1px solid #111;
	border-radius: 0px !important;
	transition: all 0.4s ease-in-out;
	margin-bottom: 20px;
	font-family: "Crimson";
}

.dropdown {
	position: relative;
	display: inline-block;
}

.dropdown-content {
	display: none;
	position: absolute;
	background-color: #f9f9f9;
	min-width: 220px;
	overflow: auto;
	box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
	z-index: 1;
}

.dropdown-content a {
	color: black;
	padding: 12px 16px;
	text-decoration: none;
	display: block;
}

.dropdown a:hover {background-color: #f1f1f1}

.show {display:block;}
#map {
	height: 600px;
    width: 100%;
}

.menu-words{
	font-style: normal;
	font-weight: 600;
	font-weight: bold;
	font-family: "Crimson";
	font-size: 19px;
	padding-top: 15px;
	padding-bottom: 5px;
	line-height: 5px;
}

.menu-form{
	margin-top: 5px;
	margin-bottom: 10px;
	width: 100%;
	margin-left: auto;
	margin-right:auto;
}

.mainbody{
    padding-left: 100px;
}

</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script>
/* When the user clicks on the button, 
toggle between hiding and showing the dropdown content */

function myFunction() {
    document.getElementById("myDropdown").classList.toggle("show");
}
</script>

<script>
function myFunction2() {
    document.querySelector('#submitform').addEventListener("click",function(){
    //dosomething including renovating current page
        confirm("Your message has been submitted successfully!");

    return false;    //try to stop page switching but failed
    },false)
}
</script>

<script>
    var map;
    var marker;
    var infowindow;
    var arrayTweets=[];
    var isLoading=false;

    function initMap()
    {
        infowindow= new google.maps.InfoWindow()
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 5,
        });
        marker = new google.maps.Marker({
            map: map,
            draggable: true,
        });
        oFormObject = document.forms['ddform'];

        if (navigator.geolocation) 
	    {
            navigator.geolocation.getCurrentPosition(function(position) {
                pos = {
        	        lat: position.coords.latitude,
        	        lng: position.coords.longitude
                };
      		    map.setCenter(pos);
      		    marker.setPosition(pos);
      		    oFormObject.elements["markerCoord"].value=marker.getPosition().toString();
      	    }, function() {
         	    pos = {lat: 40.6936996, lng: -73.9859406};
      		    map.setCenter(pos);
      		    marker.setPosition(pos);
      		    oFormObject.elements["markerCoord"].value=marker.getPosition().toString();
	        });
	    }
	    else {
        // Browser doesn't support Geolocation
      	    pos = {lat: 40.6936996, lng: -73.9859406};
      	    map.setCenter(pos);
            marker.setPosition(pos);
      	    oFormObject.elements["markerCoord"].value=marker.getPosition().toString();
        }

    	google.maps.event.addListener(map, 'click', function(event) {
      	    mouse = event.latLng;
      	    marker.setPosition(mouse);
      	    console.log(marker.getPosition().toString());
      	    oFormObject.elements["markerCoord"].value=marker.getPosition().toString();
    	});

    	google.maps.event.addListener(marker, 'drag', function(event) {
      	    console.log(marker.getPosition().toString());
      	    oFormObject.elements["markerCoord"].value=marker.getPosition().toString();
    	});
    }

    function updateMap(map,marker,mc){
        pos={lat: +mc[0], lng:+mc[1]};
        map.setCenter(pos);
        marker.setPosition(pos);
    }

    function showSpinner(){
        $(".loadingAni").append("<div class=\"spinner\"></div>");
        var spinner= $(".loadingAni").find(".spinner");

        for (var i=1;i<=3;i++){
            container="<div class=\"spinner-container container"+i.toString()+"\"></div>";
            spinner.append(container);
         }
        for (var i=1;i<=3;i++){
            var containerSelector=spinner.find(".container"+i.toString());
            for (var j=1;j<=4;j++){
                circle="<div class=\"circle"+j.toString()+"\"></div>";
                containerSelector.append(circle);
         }
       }
    }
    
    function removeSpinner(){
        $(".spinner").remove();
    }

    window.onload = function(){
        var button =$("#button");
        button.click(function(){
            if (isLoading==true){
                alert('Please wait for previous search to complete');
                return null
            }
            isLoading=true;
            showSpinner();
            arrayTweets.forEach(function(element){
               element.setMap(null);
            });
            arrayTweets=[];
            oFormObject = document.forms['ddform']
            var Coord=oFormObject.elements["markerCoord"].value
            var User=oFormObject.elements["User"].value
            var Hashtag=oFormObject.elements["Tag"].value
            var keyword=oFormObject.elements["KeyWord"].value
            console.log(Coord,User,Hashtag,keyword);
       	    var mc=Coord.replace(/^\(|\)$/g,"").split(',');
       	    updateMap(map,marker,mc);
            var url="https://saeo04uhf1.execute-api.us-east-1.amazonaws.com/v1/lambda?User="+User+"&Coord="+Coord+"&Hashtag="+Hashtag+"&keyword="+keyword;
       	    $.ajax({
                type:"GET",
                url:url,
                success:function(data){
                    removeSpinner();
                    isLoading=false;
            	    var count=data.length;
                    console.log(count);
                    if (data.length==0)
                        alert('Oops, there is no tweets at the moment!')
            	    for (i=0;i<data.length;i++){
               	        try{
               		        var coord = data[i].coord;

               		        var pos={lat:+coord.lat,lng:+coord.lng}
                            var image="./static/images/"+data[i].sentiment+".png";
               		        var s="Name: "+data[i].user_name+","+data[i].user_screen_name+"<br>"
                 	            +"Text: "+data[i].text+"<br>"
                  	            +"Hashtags: "+JSON.stringify(data[i].hashtags)+"<br>"
                    		    +"Location: "+data[i].location+"<br>"
                    		    +"Coord: ("+data[i].coord.lat+", "+data[i].coord.lng+")";

               		        var tweet = new google.maps.Marker({
               			        position: pos,
               			        map: map,
               			        icon:  image,
                                animation: google.maps.Animation.DROP,
               			        data: s
               		        })
                            arrayTweets.push(tweet);

               		        tweet.addListener('click', function() {
               			        infowindow.setContent(this.data);
               			        infowindow.open(map,this);
               		        });
             	        }
               		    catch (e){count-=1;}
           	        }
           	        console.log("Total "+count+" valid tweets.")
        	    },
                error:function(){ 
                    removeSpinner();
                    isLoading=false;

                    alert('Oops, there is no tweets at the moment!'); }
       	    });
    	});
    }
</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDUWTDh-_WOriSjCC-KFOMqV_yg2kV22s4&callback=initMap">
</script>